<VirtualHost *:80>
  ServerName <%= domain %>
  ServerAlias www.<%= domain %>

  DocumentRoot <%= deploy_to %>/current/public
  RackEnv <%= environment %>

  RewriteEngine On

  # Remove www. at the start of hostname
  RewriteCond %{HTTP_HOST} ^www.<%= domain %>$ [NC]
  RewriteRule ^/(.*)$ http://<%= domain %>/$1 [R=301,L]

  # Check for maintenance file and redirect all requests
  RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
  RewriteCond %{SCRIPT_FILENAME} !maintenance.html
  RewriteRule ^.*$ /system/maintenance.html [L]

  <Directory "<%= deploy_to %>/current/public">
    allow from all
    Options +Indexes
  </Directory>
</VirtualHost>