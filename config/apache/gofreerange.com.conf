<VirtualHost *:80>
  ServerName gofreerange.com
  ServerAlias www.gofreerange.com

  PassengerUser freerange

  DocumentRoot /home/freerange/app/public
  RackEnv production

  ###########################################
  # EXPIRES
  ###########################################

  # Ref: http://httpd.apache.org/docs/2.2/mod/mod_expires.html
  # Ref: http://api.rubyonrails.org/classes/ActionView/Helpers/AssetTagHelper.html

  ExpiresActive On
  <FilesMatch "\.(ico|gif|jpe?g|png|js|css)$">
    ExpiresDefault "access plus 1 week"
  </FilesMatch>

  AliasMatch ^/recap/docs(.*)$ /home/freerange/docs/recap$1
  <Directory "/home/freerange/docs/recap">
    PassengerEnabled off
    AllowOverride all
    Require all granted
    Options -Indexes
  </Directory>

  AliasMatch ^/mocha/docs(.*)$ /home/freerange/docs/mocha$1
  <Directory "/home/freerange/docs/mocha">
    PassengerEnabled off
    AllowOverride all
    Require all granted
    Options -Indexes
  </Directory>

  RewriteEngine On
  
  # Remove www. at the start of hostname
  RewriteCond %{HTTP_HOST} ^www.gofreerange.com$ [NC]
  RewriteRule ^/(.*)$ http://gofreerange.com/$1 [R=301,L]

  # Check for maintenance file and redirect all requests
  RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
  RewriteCond %{SCRIPT_FILENAME} !maintenance.html
  RewriteRule ^.*$ /system/maintenance.html [L]

  # Redirect incorrectly named week notes
  RewriteRule ^/week-331$ /week-231 [R=302,L]

  # Redirect Rdoc-based paths to Yard-based paths
  RewriteRule ^/mocha/docsclasses/$ /mocha/docs/ [R=301,L]
  RewriteRule ^/mocha/docsclasses/(.+)$ /mocha/docs/$1 [R=301,L]

  RewriteRule ^/mocha/docs/(.+)\.src.*$ /mocha/docs/$1.html [R=301,L]

  RewriteRule ^/mocha/docsfr_class_index\.html$ /mocha/docs/class_list.html [R=301,L]
  RewriteRule ^/mocha/docsfr_file_index\.html$ /mocha/docs/file_list.html [R=301,L]
  RewriteRule ^/mocha/docsfr_method_index\.html$ /mocha/docs/method_list.html [R=301,L]

  RewriteRule ^/mocha/docsfiles/$ /mocha/docs/file_list.html [R=301,L]
  RewriteRule ^/mocha/docsfiles/(.+)$ /mocha/docs/file.$1 [R=301,L]

  RewriteRule ^/mocha/docs_index\.html$ /mocha/docs/_index.html [R=301,L]
  RewriteRule ^/mocha/docs(.+)_rdoc\.html$ /mocha/docs/file.$1.html [R=301,L]

  RewriteRule ^/mocha/docsfile\.(.+)$ /mocha/docs/file.$1 [R=301,L]

  RewriteRule ^/mocha/docsMocha/(.+)$ /mocha/docs/Mocha/$1 [R=301,L]
  RewriteRule ^/mocha/docsMocha\.html$ /mocha/docs/Mocha.html [R=301,L]

  RewriteRule ^/mocha/docsexamples/(.+)$ /mocha/docs/file.$1 [R=301,L]

  RewriteRule ^/mocha/docs/Object\.html$ /mocha/docs/Mocha/ObjectMethods.html [R=301,L]
  RewriteRule ^/mocha/docs/Class\.html$ /mocha/docs/Mocha/ClassMethods.html [R=301,L]

  RewriteRule ^/mocha/docsClass\.html$ /mocha/docs/Mocha/ClassMethods.html [R=301,L]

  RewriteRule ^/mocha/docs/file.mocha.html$ /mocha/docs/ [R=301,L]
  RewriteRule ^/mocha/docs/file.stubba.html$ /mocha/docs/ [R=301,L]
  RewriteRule ^/mocha/docs/file.misc.html$ /mocha/docs/ [R=301,L]

  RewriteRule ^/hello-printer(.*) http://exciting.io/2012/04/12/hello-printer$1 [R=301,L]
  RewriteRule ^/printer-questions(.*) http://exciting.io/2012/05/01/printer-questions$1 [R=301,L]
  RewriteRule ^/printer-kit(.*) http://exciting.io/printer [R=301,L]
  RewriteRule ^/printer(.*) http://exciting.io/printer$1 [R=301,L]
  RewriteRule ^/harmonia(.*) http://exciting.io/harmonia [R=301,L]
  RewriteRule ^/heylist(.*) http://exciting.io/heylist [R=301,L]
  RewriteRule ^/say-hello-to-heylist(.*) http://exciting.io/2013/03/25/introducing-heylist/ [R=301,L]

  <Directory "/home/freerange/app/public">
    Options +Indexes
    Require all granted
  </Directory>

</VirtualHost>
