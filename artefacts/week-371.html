<!DOCTYPE html>
<html lang="en">
<head>
  <meta content="HTML Tidy for HTML5 for Mac OS X version 5.2.0" name="generator">
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="A small software development company based in London, UK." name="description">
  <meta content="GNqgxou6cYLkYq9l47mZM00R93JN49KqRhJebklH7uo" name="google-site-verification">
  <meta content="width=device-width" name="viewport">
  <meta content="ruby rails software development london" name="keywords">
  <meta content="telephone=no" name="format-detection">
  <link href="/assets/application-e4364b3782cc7477f226bc8504403fa41bfb8d1f7a4ed67eb3fe80f20bd5b014.css" media="all" rel="stylesheet">
  <link href="/favicon.ico" rel="shortcut icon">
  <link href="http://feeds.gofreerange.com/GoFreeRangeBlog" rel="alternate" title="Go Free Range Blog" type="application/atom+xml">
  <script src="http://use.typekit.com/rny4upv.js" type="text/javascript">
  </script>
  <script>
  try{Typekit.load();}catch(e){}
  </script>
  <title>Week 371 — Go Free Range.</title>
</head>
<body class="blog">
  <div id="page">
    <div class="group" id="header">
      <ul class="nav group" id="blog_nav">
        <li id="link_home">
          <p>Visit our <a href="/">company website</a></p>
        </li>
        <li id="link_rss">
          <p>Grab the <a href="http://feeds.gofreerange.com/GoFreeRangeBlog" title="RSS Feed from Feedburner">RSS</a> feed</p>
        </li>
      </ul>
      <h1 id="logo"><a href="/blog" title="Go to blog index">Blog index</a></h1>
    </div>
    <div class="group" id="content">
      <div class="blog_entry group">
        <p class="article_date">Sunday 13th March, 2016</p>
        <div class="author">
          <img alt="James Mead" src="images/people/james-mead.jpg"> <span>by James Mead</span>
        </div>
        <div class="content">
          <h1 id="week-371">Week 371</h1>
          <h2 id="smart-answers">Smart Answers</h2>
          <h3 id="automatic-detection-of-possible-next-nodes">Automatic detection of possible next nodes</h3>
          <p>When we started work on the project, some (but not all) smart answer flows were using calls to <code>next_node_if</code> with various predicates. We decided that it would simplify the code and maintenance of the flows if we standardised on a single approach.</p>
          <p>We didn’t think the custom predicate style was very readable and we felt that it would be unfamiliar to most developers. Also we might’ve needed to extend the predicate style in order to cater for <em>all</em> flows. So we decided to <a href="https://github.com/alphagov/smart-answers/pull/2163">standardise on the non-predicate style</a> i.e. passing in a block of Ruby code to a call to <code>next_node</code> for each question.</p>
          <p>In making this change, in order to retain the ability to visualise the flow, we had to explicitly specify a list of possible return values for each <code>next_node</code> block. This felt like a type of duplication and made the code look overly verbose.</p>
          <p>So this week I started spiking on ways to automatically detect the possible return values of a <code>next_node</code> block. I had <a href="https://github.com/alphagov/smart-answers/pull/2311">some success</a> using a combination of <a href="https://rubygems.org/gems/method_source/">method_source</a> to obtain the source code of the block, and <a href="https://github.com/whitequark/parser">parser</a> to convert the source code to an AST and filter out the relevant AST nodes.</p>
          <h3 id="refactoring-marriage-abroad">Refactoring marriage-abroad</h3>
          <p>Chris continued with his mission to refactor the <a href="https://www.gov.uk/marriage-abroad">marriage-abroad</a> flow. He’s trying to better <a href="https://github.com/alphagov/smart-answers/blob/5c53423fbf1b936692f5972567524080d3820f81/doc/refactoring.md">separate the concerns</a> by moving policy logic out of the flow and into a separate class which is more easily testable.</p>
          <p>This week he merged a couple of pull requests:</p>
          <ul>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/2297">Move logic from country_of_ceremony question to MarriageAbroadCalculator</a>
            </li>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/2307">Remove calculate blocks from country_of_ceremony question in marriage-abroad</a>
            </li>
          </ul>
          <p>And started work on another:</p>
          <ul>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/2297">WIP: Delegate to MarriageAbroadDataQuery from MarriageAbroadCalculator</a>
            </li>
          </ul>
          <h2 id="gfr">GFR</h2>
          <p>As usual this was mostly admin-related work:</p>
          <ul>
            <li>
              <p>I wrote up some notes on the meeting I had at GDS the previous week.</p>
            </li>
            <li>
              <p>We finally received a belated refund relating to our storage unit at Urban Locker and Chris sorted out the related book-keeping in <a href="http://www.freeagent.com/">FreeAgent</a>.</p>
            </li>
            <li>
              <p>Our <a href="https://harmonia.io">Harmonia</a> task for paying ourselves had grown considerably over the years and we decided to split it up into a number of smaller tasks. Chris finished off doing this during the week.</p>
            </li>
            <li>
              <p>Our staging date for <a href="http://www.thepensionsregulator.gov.uk/en/employers">pension auto-enrolment</a> is 1st April and so Chris double-checked that we’re compliant with the legislation.</p>
            </li>
          </ul>
          <p>That’s it for this week. Until next time.</p>
          <p>– James</p>
        </div>
        <div class="comments" id="comments">
          Disqus commenting is only enabled in production.
        </div>
      </div>
      <div id="article_links">
        <h3>Recent</h3>
        <div id="recent_articles">
          <ol class="blog_list" reversed="">
            <li value="6">
              <a href="/week-446">Week 446</a>
            </li>
            <li value="5">
              <a href="/week-447">Week 447</a>
            </li>
            <li value="4">
              <a href="/broken-rubyforge-urls">Broken Rubyforge URLs</a>
            </li>
            <li value="3">
              <a href="/week-446-links">Week 446 - Interesting links</a>
            </li>
            <li value="2">
              <a href="/week-444">Week 444</a>
            </li>
            <li value="1">
              <a href="/week-444-links">Week 444 - Interesting links</a>
            </li>
          </ol>
        </div>
      </div>
    </div>
  </div>
  <script src="/assets/application-a06a15e76d88968aa98de5792d639d527018444227ecda8004f3fb4a3e0d1d6f.js">
  </script> 
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45002715-1', 'gofreerange.com');
  ga('send', 'pageview');

  </script>
</body>
</html>
