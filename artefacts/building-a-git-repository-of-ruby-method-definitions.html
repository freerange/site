<!DOCTYPE html>
<html lang='en'>
<head>
  <meta content="HTML Tidy for HTML5 for Mac OS X version 5.2.0" name="generator">
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="A small software development company based in London, UK." name="description">
  <meta content="GNqgxou6cYLkYq9l47mZM00R93JN49KqRhJebklH7uo" name="google-site-verification">
  <meta content="width=device-width" name="viewport">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <link href="/stylesheets/screen.css" rel="stylesheet" title="screen" type="text/css">
  <link href="http://feeds.gofreerange.com/GoFreeRangeBlog" rel='alternate' title='Go Free Range Blog' type='application/atom+xml'>
  <script src='http://use.typekit.com/rny4upv.js' type='text/javascript'>
  </script>
  <script>
  try{Typekit.load();}catch(e){}
  </script>
  <title>Building a Git repository of Ruby method definitions — Go Free Range.</title>
</head>
<body class='blog'>
  <div id='page'>
    <div class='group' id='header'>
      <ul class='nav group' id='blog_nav'>
        <li id='link_home'>
          <p>Visit our <a href='/'>company website</a></p>
        </li>
        <li id='link_rss'>
          <p>Grab the <a href='http://feeds.gofreerange.com/GoFreeRangeBlog' title='RSS Feed from Feedburner'>RSS</a> feed</p>
        </li>
      </ul>
      <h1 id='logo'><a href='/blog' title='Go to blog index'>Blog index</a></h1>
    </div>
    <div class='group' id='content'>
      <div class='blog_entry group'>
        <p class='article_date'>Sunday 16th March, 2014</p>
        <div class='author'>
          <img alt='James Mead' src='images/people/james-mead.jpg'> <span>by James Mead</span>
        </div>
        <div class='content'>
          <h1 id="building-a-git-repository-of-ruby-method-definitions">Building a Git repository of Ruby method definitions</h1>
          <p>As <a href="/chris-roos">Chris</a> mentioned in the <a href="/week-269#method-log">notes from last week</a>, I’ve come up with an idea for a useful way to represent the history of Ruby method definitions.</p>
          <p>I’ve <a href="https://github.com/freerange/method_log/commit/c204b231da164b4068d9bb0d9c56ac04a2d95146">hacked together a script</a> to walk through <em>all</em> the commits in a repository extracting <em>all</em> the method definitions using the Ruby parser code I already had. The script builds a new “shadow” repository with a commit for each commit in the original repository, but constructing a “file” for each method definition.</p>
          <p>Thus the script turns the method definition for <code>Foo::Bar#baz</code> into the “file” <code>Foo/Bar/#baz.rb</code> and the one for <code>Foo.bar</code> into <code>Foo/.bar.rb</code>. I know this sounds crazy, but by doing this it means that a number of Git tools just work and give interesting results.</p>
          <p>I’ve run the script against the <a href="https://github.com/freerange/mocha">Mocha repository</a> so you can see what I mean. If you click the “Show Diff Stats” button on <a href="https://github.com/freerange/mocha.methods/commit/142ad22dfaabf4947cf4ad4f3f4d47c8725fb190">this commit page</a> then you can see which methods have been added, modified & changed. You can even see methods that have been moved and/or renamed!</p>
          <p><img src="/images/blog/github-commit-diff-stat-renamed-methods.png"></p>
          <p>You can also see the <a href="https://github.com/freerange/mocha.methods/commits/master/Mocha/Expectation/%23method_signature.rb">history of an individual method on GitHub</a> or the patch version using <code>git log --patch</code> on your local machine. This is actually the same functionality as <code>method_log</code> itself already provides, but it solves the speed problem that I mentioned in my <a href="/tracing-the-git-history-of-a-ruby-method#further-work">earlier article</a>.</p>
          <p><img src="/images/blog/method-signature-git-log-patch.png"></p>
          <p>I think it would be trivial to run the script against a repository and then add an after-commit hook to update the “shadow” repository after each commit to keep it up-to-date. It would also be possible to link the commits in the “shadow” repository to those in the original repository.</p>
          <p>Anyway, hopefully that’s some food for thought. I’d love to hear what you think.</p>
        </div>
        <div class='comments' id='comments'>
          Disqus commenting is only enabled in production.
        </div>
      </div>
      <div id='article_links'>
        <h3>Recent</h3>
        <div id='recent_articles' style="margin-left: 2em">
          <ul class='blog_list' reversed="">
            <li value="6">
              <a href="/week-443">Week 443</a>
            </li>
            <li value="5">
              <a href="/week-441">Week 441</a>
            </li>
            <li value="4">
              <a href="/week-442">Week 442</a>
            </li>
            <li value="3">
              <a href="/week-442-links">Week 442 - Interesting links</a>
            </li>
            <li value="2">
              <a href="/week-440">Week 440</a>
            </li>
            <li value="1">
              <a href="/week-440-links">Week 440 - Interesting links</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <script charset="utf-8" src="/javascripts/app.js" type="text/javascript">
  </script> 
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45002715-1', 'gofreerange.com');
  ga('send', 'pageview');

  </script>
</body>
</html>
