<!DOCTYPE html>
<html lang="en">
<head>
  <meta content="HTML Tidy for HTML5 for Apple macOS version 5.6.0" name="generator">
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="A small software development company based in London, UK." name="description">
  <meta content="GNqgxou6cYLkYq9l47mZM00R93JN49KqRhJebklH7uo" name="google-site-verification">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="ruby rails software development london" name="keywords">
  <meta content="telephone=no" name="format-detection">
  <link href="/assets/application-1507e54ca8e8109b8f18bb949aa6426ff1f387a59a864a86de4dbd371b20b242.css" media="all" rel="stylesheet">
  <link href="/favicon.ico" rel="shortcut icon">
  <link href="http://feeds.gofreerange.com/GoFreeRangeBlog" rel="alternate" title="Go Free Range Blog" type="application/atom+xml">
  <script src="http://use.typekit.com/rny4upv.js" type="text/javascript"></script>
  <script>
  try{Typekit.load();}catch(e){}
  </script>
  <title>Week 449 — Go Free Range.</title>
</head>
<body class="blog">
  <div id="page">
    <div class="group" id="header">
      <ul class="nav group" id="blog_nav">
        <li id="link_home">
          <p>Visit our <a href="/">company website</a></p>
        </li>
        <li id="link_rss">
          <p>Grab the <a href="http://feeds.gofreerange.com/GoFreeRangeBlog" title="RSS Feed from Feedburner">RSS</a> feed</p>
        </li>
      </ul>
      <h1 id="logo"><a href="/blog" title="Go to blog index">Blog index</a></h1>
    </div>
    <div class="group" id="content">
      <div class="blog_entry group">
        <p class="article_date">Friday 25th August, 2017</p>
        <div class="author">
          <img alt="Chris Lowis" src="images/people/chris-lowis.jpg"> <span>by Chris Lowis</span>
        </div>
        <div class="content">
          <h1 id="week-449">Week 449</h1>
          <p>I spent the first half of this week at the <a href="http://wac.eecs.qmul.ac.uk/">Web Audio Conference</a>. It was great to catch up with some familiar people and learn more about what people are working on. I’ve been involved with this community for a long time and it’s really encouraging to see how it is growing and developing - there were around 100 people at the conference this year. I’ll be writing more about the conference <a href="http://www.webaudioweekly.com/">in my newsletter</a>. I met up with James at the Outlandish co-working space (now officially called “Space4”) on Thursday to catch up on what James and Chris had been working on in my absence.</p>
          <h2 id="gds">GDS</h2>
          <p>We’ve finally got some confidence that our approach of proxying requests for assets to S3 is going to perform well enough. <a href="https://github.com/alphagov/asset-manager/issues/150">We used Kibana and Graphite</a> to give us an idea of the traffic that the Asset Manager app currently responds to. We used <a href="https://httpd.apache.org/docs/2.4/programs/ab.html">Apache bench</a> to compare the performance of Asset Manager using Sendfile to Asset Manager proxying to S3. We decided that when we deploy to production we’ll <a href="https://github.com/alphagov/asset-manager/issues/151">direct a fixed percentage</a> of requests to S3 to begin with - this will allow us to monitor the impact of the change on the infrastructure.</p>
          <p>To minimise the impact of this change on citizens we want to ensure that any caching that is already in place (GOV.UK use <a href="https://www.fastly.com/">fastly</a> as an edge-side CDN) won’t be invalidated. To achieve this we needed to overwrite the ETag header that S3 generates with one that matches what nginx would have added. We achieved this <a href="https://github.com/alphagov/asset-manager/pull/157">by implementing nginx’s ETag generation in Rails</a> and <a href="https://github.com/alphagov/govuk-puppet/pull/6355">adding it to the proxied requests</a> in an nginx <code>location</code> block. Once deployed we’ll be able to control when the caches are invalidated to minimise the impact.</p>
          <p>We’ve also started a conversation to see whether we can work with user-researchers at GDS to work out what citizens expect from assets. We hope this will help us make a decision about the URLs we use if we eventually serve the assets directly from S3.</p>
          <p>As the long weekend approaches we feel as though we can finally see a path to getting all of the “mainstream” assets moved to S3!</p>
          <p>We finished up the week today working remotely - me from the <a href="http://www.roundhouse.org.uk/">Roundhouse</a> Cafe in Camden, Chris from his boat on the Thames and James from home.</p>
          <p>Have a great weekend!</p><!-- add content here -->
        </div>
        <div class="comments" id="comments">
          Disqus commenting is only enabled in production.
        </div>
      </div>
      <div id="article_links">
        <h3>Recent</h3>
        <div id="recent_articles">
          <ol class="blog_list" reversed="">
            <li value="6">
              <a href="/week-481">Week 481</a>
            </li>
            <li value="5">
              <a href="/week-480">Week 480</a>
            </li>
            <li value="4">
              <a href="/week-477">Week 477</a>
            </li>
            <li value="3">
              <a href="/week-479">Week 479</a>
            </li>
            <li value="2">
              <a href="/week-478">Week 478</a>
            </li>
            <li value="1">
              <a href="/week-478-links">Week 478 - Interesting links</a>
            </li>
          </ol>
        </div>
      </div>
    </div>
  </div>
  <script src="/assets/application-a06a15e76d88968aa98de5792d639d527018444227ecda8004f3fb4a3e0d1d6f.js"></script> 
  <script>


  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45002715-1', 'gofreerange.com');
  ga('send', 'pageview');

  </script>
</body>
</html>
