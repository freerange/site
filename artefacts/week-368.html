<!DOCTYPE html>
<html lang="en">
<head>
  <meta content="HTML Tidy for HTML5 for Apple macOS version 5.6.0" name="generator">
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="A small software development company based in London, UK." name="description">
  <meta content="GNqgxou6cYLkYq9l47mZM00R93JN49KqRhJebklH7uo" name="google-site-verification">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="ruby rails software development london" name="keywords">
  <meta content="telephone=no" name="format-detection">
  <link href="/assets/application-1507e54ca8e8109b8f18bb949aa6426ff1f387a59a864a86de4dbd371b20b242.css" media="all" rel="stylesheet">
  <link href="//vjs.zencdn.net/4.7.2/video-js.css" rel="stylesheet">
  <link href="/favicon.ico" rel="shortcut icon">
  <link href="http://feeds.gofreerange.com/GoFreeRangeBlog" rel="alternate" title="Go Free Range Blog" type="application/atom+xml">
  <script src="http://use.typekit.com/rny4upv.js" type="text/javascript"></script>
  <script>
  try{Typekit.load();}catch(e){}
  </script>
  <script src="//vjs.zencdn.net/4.7.2/video.js"></script>
  <title>Week 368 — Go Free Range.</title>
</head>
<body class="blog">
  <div id="page">
    <div class="group" id="header">
      <ul class="nav group" id="blog_nav">
        <li id="link_home">
          <p>Visit our <a href="/">company website</a></p>
        </li>
        <li id="link_rss">
          <p>Grab the <a href="http://feeds.gofreerange.com/GoFreeRangeBlog" title="RSS Feed from Feedburner">RSS</a> feed</p>
        </li>
      </ul>
      <h1 id="logo"><a href="/blog" title="Go to blog index">Blog index</a></h1>
    </div>
    <div class="group" id="content">
      <div class="blog_entry group">
        <p class="article_date">Sunday 28th February, 2016</p>
        <div class="author">
          <img alt="James Mead" src="images/people/james-mead.jpg"> <span>by James Mead</span>
        </div>
        <div class="content">
          <h1 id="week-368">Week 368</h1>
          <h2 id="ir35-tax-assurances">IR35 Tax Assurances</h2>
          <p>Early in the week we heard back from <a href="http://www.egos.co.uk/">Egos Consultancy</a> about our IR35 situation regarding our work for <a href="https://gds.blog.gov.uk/">GDS</a>. As expected they confirmed that the combination of our contract and working practices fall outside IR35.</p>
          <p>They also suggested some small changes to the <a href="http://www.egos.co.uk/ir35_wpq.htm">Working Practices Questionnaire</a> that we’d completed in the previous week. During the course of this week <a href="/chris-roos">Chris</a> & I collaboratively addressed these changes to the questionnaire in preparation for sending it to GDS.</p>
          <h2 id="smart-answers">Smart Answers</h2>
          <p>I started work back on Smart Answers this week. I only managed to fit in 1.5 days and I ended up spending the whole time reviewing the backlog of pull requests that had built up while Erik was working on Smart Answers single-handed.</p>
          <p>The most urgent one involved <a href="https://github.com/alphagov/smart-answers/pull/2192">the removal of some functionality in the State Pension Calculator</a>, so I tackled that one first. I also reviewed updates to the <a href="https://github.com/alphagov/smart-answers/pull/2166">Child Maintenance Calculator</a> and <a href="https://github.com/alphagov/smart-answers/pull/2242">to the Benefits Cap Calculator</a>.</p>
          <p>Then there was the inevitable bunch of pull requests for the <a href="https://www.gov.uk/marriage-abroad">Marriage Abroad Smart Answer</a> which needed reviewing:</p>
          <ul>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/2197">Italy, Philippines and South Africa</a>
            </li>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/2258">Kuwait</a>
            </li>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/2200">Bulgaria</a>
            </li>
          </ul>
          <p>I also reviewed a pull request <a href="https://github.com/alphagov/smart-answers/pull/2199">upgrading the version of Ruby used in the app to v2.2.4</a> and another which <a href="https://github.com/alphagov/smart-answers/pull/2238">tweaked the maximum size of one of the caches</a>.</p>
          <p>Lastly I closed a pull request which was simply <a href="https://github.com/alphagov/smart-answers/pull/2239">a demonstration of how to reproduce a bug</a>. Having recorded the bug in Trello, I didn’t think it was worthwhile keeping the pull request open.</p>
          <h2 id="hookline">Hookline</h2>
          <h3 id="google-chrome-bug">Google Chrome Bug</h3>
          <p>I continued my investigation into why a number of MP3 tracks wouldn’t play in Google Chrome. I had previously noticed that <code>ffprobe</code> (part of <a href="https://www.ffmpeg.org/">FFmpeg</a>) gave an error when trying to parse the problematic MP3, whereas it correctly parsed the MP3’s which play OK in Chrome. At around this time I also discovered that Chrome uses parts of FFmpeg to play audio files, so this seemed to be highly relevant.</p>
          <p><a href="http://ffmpeg.org/pipermail/ffmpeg-user/2016-January/030435.html">I emailed the FFmpeg mailing list</a> and asked for help. One of the developers said that it was a bug and raised a <a href="https://trac.ffmpeg.org/ticket/5205">ticket in their system</a>. Not long afterwards the bug was fixed, although there was some scepticism from other people that this was a sensible fix and/or that the “probe” code around MP3’s with <a href="http://id3.org/id3v2.3.0">ID3 tags</a> is very robust.</p>
          <p>There’s been no real explanation of what the problem was other than the <a href="http://git.videolan.org/?p=ffmpeg.git;a=commitdiff;h=77864be44a0daeae846d7395b3cb682a22ce99a9">commit which fixes it</a>. I hoped that there would be a way to work around the problem by changing the ID3 tag on that MP3 and asked about this on the mailing list. I wanted to avoid having to wait for FFmpeg to release the fix and then for Chrome to include the release in a release of Chrome, all of which would probably take ages. However, at this point I raised this problem as a <a href="https://code.google.com/p/chromium/issues/detail?id=582898">bug report for Google Chrome</a> to try to hurry them along.</p>
          <p>Rather than waiting for the Chrome bug to be fixed, I then had a go at working around the problem. I used <code>ffmpeg</code> to re-encode the original WAV file to MP3, but this time I re-tagged it with the artwork and other metadata (using <a href="https://github.com/robinst/taglib-ruby">taglib-ruby</a>) to closely match the original MP3. Some combination of doing this seemed to (magically) avoid the bug and so I replaced the original problematic MP3 and the track played OK in Google Chrome. Yay!</p>
          <p>I then wrote a simple script to use <code>ffprobe</code> to check all the other tracks in our database for the same problem. Fortunately it seems to be a real edge case and I didn’t find any other problematic tracks.</p>
          <h3 id="ordering-tracks-in-playlist">Ordering Tracks in Playlist</h3>
          <p>Later this week, I finally got round to merging some work I’d done back in November 2015 on allowing the user to control the order of tracks in a playlist.</p>
          <p>I used a combination of <a href="https://jqueryui.com/sortable/">jQuery UI’s Sortable</a> and the <a href="https://github.com/mixonic/ranked-model">ranked-model gem</a> to implement a progressively enhanced drag-and-drop UI for changing the order of tracks within a playlist.</p>
          <p>The work wasn’t complete, but at least I got a bunch of local changes merged into the <code>master</code> branch and deployed to production.</p>
          <p>Anyway, apart from the usual company admin tasks, I think that’s everything we got up to.</p>
          <p>Until next time.</p>
          <p>– James</p>
        </div>
        <div class="comments" id="comments">
          Disqus commenting is only enabled in production.
        </div>
      </div>
      <div id="article_links">
        <h3>Recent</h3>
        <div id="recent_articles">
          <ol class="blog_list" reversed="">
            <li value="6">
              <a href="/week-488">Week 488</a>
            </li>
            <li value="5">
              <a href="/week-490">Week 490</a>
            </li>
            <li value="4">
              <a href="/week-487">Week 487</a>
            </li>
            <li value="3">
              <a href="/week-485">Week 485</a>
            </li>
            <li value="2">
              <a href="/week-484">Week 484</a>
            </li>
            <li value="1">
              <a href="/upcoming-availability">Upcoming availability</a>
            </li>
          </ol>
        </div>
      </div>
    </div>
  </div>
  <script src="/assets/application-a06a15e76d88968aa98de5792d639d527018444227ecda8004f3fb4a3e0d1d6f.js"></script> 
  <script>


  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45002715-1', 'gofreerange.com');
  ga('send', 'pageview');

  </script>
</body>
</html>
