<!DOCTYPE html>
<html lang="en">
<head>
  <meta content="HTML Tidy for HTML5 for Mac OS X version 5.2.0" name="generator">
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="A small software development company based in London, UK." name="description">
  <meta content="GNqgxou6cYLkYq9l47mZM00R93JN49KqRhJebklH7uo" name="google-site-verification">
  <meta content="width=device-width" name="viewport">
  <meta content="ruby rails software development london" name="keywords">
  <meta content="telephone=no" name="format-detection">
  <link href="/assets/application-e4364b3782cc7477f226bc8504403fa41bfb8d1f7a4ed67eb3fe80f20bd5b014.css" media="all" rel="stylesheet">
  <link href="/favicon.ico" rel="shortcut icon">
  <link href="http://feeds.gofreerange.com/GoFreeRangeBlog" rel='alternate' title='Go Free Range Blog' type='application/atom+xml'>
  <script src='http://use.typekit.com/rny4upv.js' type='text/javascript'>
  </script>
  <script>
  try{Typekit.load();}catch(e){}
  </script>
  <title>Week 336 — Go Free Range.</title>
</head>
<body class="blog">
  <div id="page">
    <div class="group" id="header">
      <ul class='nav group' id='blog_nav'>
        <li id='link_home'>
          <p>Visit our <a href='/'>company website</a></p>
        </li>
        <li id='link_rss'>
          <p>Grab the <a href='http://feeds.gofreerange.com/GoFreeRangeBlog' title='RSS Feed from Feedburner'>RSS</a> feed</p>
        </li>
      </ul>
      <h1 id="logo"><a href="/blog" title="Go to blog index">Blog index</a></h1>
    </div>
    <div class="group" id="content">
      <div class="blog_entry group">
        <p class="article_date">Friday 03rd July, 2015</p>
        <div class="author">
          <img alt="James Mead" src="images/people/james-mead.jpg"> <span>by James Mead</span>
        </div>
        <div class="content">
          <h1 id="week-336">Week 336</h1>
          <p>This week we went back to our old routine and worked on Smart Answers from Monday to Thursday, spending Monday & Wednesday at Aviation House and Tuesday & Thursday at GFRHQ. Friday was our usual “GFR” day which we spent at GFRHQ.</p>
          <h2 id="smart-answers">Smart Answers</h2>
          <p>We spent most of the time converting the flows in the Smart Answers app to use ERB templates instead of the Ruby DSL/I18n/YAML combination. It was at this point that the regression tests really started to earn their keep - they’ve given us confidence to do the conversion without worrying that we’ve broken anything. These are the ones we converted:</p>
          <ul>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/1731">benefit-cap-calculator</a>
            </li>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/1732">calculate-agricultural-holiday-entitlement</a>
            </li>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/1740">calculate-married-couples-allowance</a>
            </li>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/1751">state-pension-topup</a>
            </li>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/1749">towing-rules</a>
            </li>
            <li>
              <a href="https://github.com/alphagov/smart-answers/pull/1736">uk-benefits-abroad</a>
            </li>
          </ul>
          <p>A few branches have been out for Fact Check for a while. This has meant that they’ve become out-of-date with <code>master</code>. One branch in particular was particularly problematic, because of a couple of awkward conflicts. The branch pre-dated our <a href="https://github.com/alphagov/smart-answers/commit/2910747663879e0b8d42fc32ff9fa41649ab49bf">conversion of the flows into classes</a> and so the changes to the flow were made against a non-indented version of the code. Also the branch contained a couple of commits which refactored the flow’s integration test to flatten the deeply nested context blocks. Unfortunately all of this (both flow and integration test changes) conflicted with some <a href="https://github.com/alphagov/smart-answers/commit/f3eea3b8bf1708294afaa40cabda19e8902b385d#diff-786ed10c1801bf5dbb7a61b5de6f4e8a">changes to date question ranges and validation</a> which had been made in <code>master</code>. In an effort to make a start on sorting this out, Chris & I paired on getting the two commits which refactored the integration test <a href="https://github.com/alphagov/smart-answers/pull/1733">merged into <code>master</code></a>.</p>
          <p>Chris came across the first use of <code>next_steps</code> content in the <code>calculate-married-couples-allowance</code> flow. This is content which appears in a “sidebar” at the top right of the outcome page. You can see an example of it on this <a href="https://www.gov.uk/calculate-married-couples-allowance/y/yes/no/1955-01-01/20000">outcome page</a>. We chatted about what approach to take and agreed that it was worth trying the idea of using <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/CaptureHelper.html#method-i-content_for"><code>ActionView::Helpers::CaptureHelper#content_for</code></a>. Up until this point we’d been using up to two templates per outcome, one for the <code>title</code> and one for the <code>body</code>. Chris came up with a solution which meant that we could <a href="https://github.com/alphagov/smart-answers/pull/1737">use a single template per outcome</a> including <code>content_for</code> blocks for both <code>title</code> and <code>body</code>. He then went on to implement provision for a <code>content_for(:next_steps)</code> block in the <code>calculate-married-couples-allowance</code> flow.</p>
          <p>With some help from <a href="http://dsingleton.co.uk/">David Singleton</a> I setup a <a href="https://github.com/alphagov/smart-answers/pull/1748">nightly Jenkins build</a> to run all our regression tests. The complete suite takes about an hour to run and because of this a while back we decided to avoid running them all as part of the main CI build - we only run the regression tests for flows whose files have changed. Having this nightly build gives us an extra level of confidence that all the regression tests are passing.</p>
          <p>We finally achieved consensus on how to setup analytics to track what percentage of people who start using a Smart Answer make it through to an “outcome” page. Chris implemented this by <a href="https://github.com/alphagov/smart-answers/pull/1742">firing a Google Analytics event on outcome pages</a>. It’ll be interesting to see an analysis of the data that this produces.</p>
          <p>I found a bug in the formatting of “contact boxes”. I traced the problem back to a <a href="https://github.com/alphagov/govspeak/issues/55">bug in Govspeak</a>, but since it’s probably going to take a while to agree a fix for Govspeak, I <a href="https://github.com/alphagov/smart-answers/pull/1738">re-introduced a workaround for the instances which I’d come across in uk-benefits-abroad</a>. I suspect this bug and/or the workaround is fairly widespread and so I hope to submit a pull request to Govspeak when I get the chance.</p>
          <p>In response to a request from <a href="http://tekin.co.uk/">Tekin</a>, I <a href="https://github.com/alphagov/smart-answers/pull/1735">disabled the session store</a> in the Smart Answers app. To be honest I wasn’t aware that you have to explicitly disable it, so that was good to find out.</p>
          <h2 id="gfr">GFR</h2>
          <p>On Wednesday we had a maritime edition of our monthly drinks aboard the 209ft steamer, <a href="http://www.thetattershallcastle.co.uk/">Tattershall Castle</a> which is moored on the Embankment. We spent the first part of the evening enjoying the sunshine (or glimpses of it) on the main deck with pleasant views up the Thames. We were all a bit alarmed to discover the deck was moving beneath our feet, but we soon got our sea legs. Later in the evening we moved down below where it was a bit quieter and we had a table to ourselves.</p>
          <p>On Friday morning Andrew Pavord of <a href="http://www.filmfixer.co.uk/">FilmFixer</a> came to our office for a chat. If you’re making a film and you need some locations on which to shoot, Andrew is your man. The app used by most of the London borough councils (and in cities around the world) to manage such applications from film production companies. Andrew isn’t technical himself, but he used to be a freelance Location Manager for film production companies so he has a deep knowledge of the problem domain. Anyway, I think it’s impressive how he’s built up a system and a business in this area using only out-sourced developers.</p>
          <p>For lunch we headed back to <a href="http://www.streetfeastlondon.com/where/dinerama">Dinerama</a> which Chris & I had reconnoitred the previous lunchtime. We claimed our free beer and sizzled in the heat on the top deck with <a href="http://chrislowis.co.uk/">Chris L</a>, <a href="http://h-lame.com/">Murray</a> and <a href="https://twitter.com/beng">Ben G</a>.</p>
          <p>Chris & I returned to GFRHQ with Chris L for the afternoon and did a bit of admin. I spent much of the afternoon upgrading Rails, Rack, etc on our Linode box in reponse to the recent security advisories. Chris L published <a href="http://blog.chrislowis.co.uk/waw/2015/06/26/web-audio-weekly-41.html">Web Audio Weekly #41</a>.</p>
        </div>
        <div class="comments" id="comments">
          Disqus commenting is only enabled in production.
        </div>
      </div>
      <div id="article_links">
        <h3>Recent</h3>
        <div id="recent_articles">
          <ol class="blog_list" reversed="">
            <li value="6">
              <a href="/week-446-links">Week 446 - Interesting links</a>
            </li>
            <li value="5">
              <a href="/week-444">Week 444</a>
            </li>
            <li value="4">
              <a href="/week-444-links">Week 444 - Interesting links</a>
            </li>
            <li value="3">
              <a href="/week-443">Week 443</a>
            </li>
            <li value="2">
              <a href="/week-441">Week 441</a>
            </li>
            <li value="1">
              <a href="/week-442">Week 442</a>
            </li>
          </ol>
        </div>
      </div>
    </div>
  </div>
  <script src="/assets/application-a06a15e76d88968aa98de5792d639d527018444227ecda8004f3fb4a3e0d1d6f.js">
  </script> 
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45002715-1', 'gofreerange.com');
  ga('send', 'pageview');

  </script>
</body>
</html>
